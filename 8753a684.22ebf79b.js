(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{70:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return l}));var r=n(2),a=n(6),i=(n(0),n(92)),o={id:"receiving",title:"Web Monetization Receivers",sidebar_label:"Receiving payments"},s={unversionedId:"receiving",id:"receiving",isDocsHomePage:!1,title:"Web Monetization Receivers",description:"This page describes the functions of the Web Monetization (WM) receiver and how",source:"@site/docs/receiving.md",slug:"/receiving",permalink:"/docs/receiving",editUrl:"https://github.com/WICG/webmonetization/tree/master/docs/receiving.md",version:"current",sidebar_label:"Receiving payments",sidebar:"docs",previous:{title:"Web Monetization Explainer",permalink:"/docs/explainer"},next:{title:"Web Monetization Providers (Sending Payments)",permalink:"/docs/sending"}},c=[{value:"Payment pointers",id:"payment-pointers",children:[]},{value:"Receiving payments",id:"receiving-payments",children:[{value:"Interledger protocol (ILP)",id:"interledger-protocol-ilp",children:[]},{value:"Simple Payment Setup protocol (SPSP)",id:"simple-payment-setup-protocol-spsp",children:[]},{value:"STREAM protocol",id:"stream-protocol",children:[]}]}],p={rightToc:c};function l(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"This page describes the functions of the Web Monetization (WM) receiver and how\nexisting payment services might become a WM receiver."),Object(i.b)("p",null,"A WM receiver is a digital entity that accepts payments over Interledger\non behalf of a website and is capable of receiving micropayments."),Object(i.b)("p",null,"When a user has Web Monetization enabled in their browser and they visit a\nmonetized website, the browser resolves a unique receiving address for sending\npayments to the website's WM receiver. The browser then begins sending payments\nthrough the user's WM sender."),Object(i.b)("h2",{id:"payment-pointers"},"Payment pointers"),Object(i.b)("p",null,"A ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://paymentpointers.org"}),"payment pointer")," is a unique URL assigned to your\npayment account by your WM receiver."),Object(i.b)("p",null,"The expectation is that a WM receiver will issue one or more payment pointers to\nits customers and these customers will embed the pointer into the websites they\nwant to monetize. The user's browser then fetches connection details from the\npointer to open a payment stream with the WM receiver."),Object(i.b)("p",null,"Payment pointers resolve to secure URLs, making it possible for WM receivers to\nredirect browsers to alternate addresses using standard HTTP redirects."),Object(i.b)("p",null,"One benefit of payment pointers is that they provide a level of indirection that\nallows browsers to protect the privacy of users from their WM senders. Specifically,\na browser uses a pointer to request a unique destination address and shared\nsecret from the website's WM  receiver. Only the unique destination address\nfor the session is given to the WM sender. This prevents the WM sender from\ncorrelating a payment pointer with a website."),Object(i.b)("h2",{id:"receiving-payments"},"Receiving payments"),Object(i.b)("p",null,"Any entity that is able to accept payments on behalf of websites can be a WM\nreceiver if it supports the necessary protocols. To accept a stream of payments\non behalf of its users, a WM receiver ",Object(i.b)("strong",{parentName:"p"},"MUST")," support the following protocols\nfrom the Interledger stack:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Interledger Protocol (ILP) - Establishes a micropayment stream and sends payments"),Object(i.b)("li",{parentName:"ul"},"Simple Payment Setup Protocol (SPSP) - Exchanges payment information between\npayee and payer to facilitate payment over ILP"),Object(i.b)("li",{parentName:"ul"},"STREAM Protocol - Establishes micropayment streams between entities using the ILP")),Object(i.b)("h3",{id:"interledger-protocol-ilp"},"Interledger protocol (ILP)"),Object(i.b)("p",null,"The ILP routes individual micropayments. Interledger allows for payments to be\nsent at very high volumes and in very small denominations. Payments are sent as\nInterledger packets, which are optimized for this use case."),Object(i.b)("p",null,"The WM receiver must set up a link into the Interledger network. More specifically,\nthe WM receiver must have an Interledger connection (direct or indirect) to any\nweb monetized senders that want to pay the WM receiver."),Object(i.b)("h3",{id:"simple-payment-setup-protocol-spsp"},"Simple Payment Setup protocol (SPSP)"),Object(i.b)("p",null,"The SPSP exchanges payment information between the WM receiver and WM sender to\nfacilitate payment over the ILP. The WM receiver must host a secure HTTP endpoint\nthat returns a unique destination address and shared secret for each request."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"SPSP messages ",Object(i.b)("strong",{parentName:"p"},"MUST")," be exchanged over HTTPS.")),Object(i.b)("h4",{id:"example-response-to-an-spsp-request"},"Example Response to an SPSP request"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Alice is a customer of ",Object(i.b)("em",{parentName:"p"},"Secure Receiving Wallet Ltd.")," who can act as a Web\nMonetization receiver.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"She is allocated the SPSP endpoint URL ",Object(i.b)("inlineCode",{parentName:"p"},"https://securewallet.example/~alice"),"."),Object(i.b)("blockquote",{parentName:"li"},Object(i.b)("p",{parentName:"blockquote"},"This URL can also be expressed as: ",Object(i.b)("inlineCode",{parentName:"p"},"$securewallet.example/~alice"),"."))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"A GET request is made to her SPSP endpoint URL with an ",Object(i.b)("inlineCode",{parentName:"p"},"accept")," header of ",Object(i.b)("inlineCode",{parentName:"p"},"application/spsp4+json"),"."))),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-json"}),"GET https://securewallet.example/~alice\nAccept: application/spsp4+json\n")),Object(i.b)("ol",{start:4},Object(i.b)("li",{parentName:"ol"},"The server responds with a JSON response carrying the Interledger destination\naddress and shared secret to open a payment stream with\n",Object(i.b)("em",{parentName:"li"},"Secure Receiving Wallet")," and send Alice money.")),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ts"}),'{\n  "destination_account": "test.example.hRWyGw4JzvFCdMUlEKd1kXPZ",\n  "shared_secret": "qobHsPWoyWh0gCQLx2e9x1bQeDikD4fdmYHGT52VKn8="\n}\n')),Object(i.b)("p",null,"More details on SPSP can be found in\n",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://interledger.org/rfcs/0009-simple-payment-setup-protocol/"}),"IL-RFC 0009 - Simple Payment Setup Protocol"),"."),Object(i.b)("h3",{id:"stream-protocol"},"STREAM protocol"),Object(i.b)("p",null,"The STREAM protocol establishes micropayment streams between entities using the\nILP. STREAM is loosely based on QUIC and provides similar features over ILP that\nQUIC does over IP. STREAM stands for STREAMing Transport for the Real-Time\nExchange of Assets and Messages."),Object(i.b)("p",null,"For an entity to be a WM receiver, it only needs to run a STREAM server, accept\nconnections, and handle the incoming payments sent over the connection."),Object(i.b)("p",null,"The browser uses the connection parameters (ILP destination address and shared\nsecret) it acquired through ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"#simple-payment-setup-protocol-spsp"}),"SPSP")," to\nestablish a STREAM connection with the WM receiver. Then, a stream of payments\ncan be made to the WM receiver until the stream is closed."),Object(i.b)("p",null,"Each set of connection parameters is unique, meaning the user's WM sender can't\ncorrelate the payments it makes with the website."),Object(i.b)("p",null,"The WM receiver may issue payment receipts via the STREAM connection. The\nbrowser can submit receipts to the web page allowing the page to verify payment\nduring a user's session."))}l.isMDXComponent=!0},92:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return u}));var r=n(0),a=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),l=function(e){var t=a.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},b=function(e){var t=l(e.components);return a.a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),b=l(n),d=r,u=b["".concat(o,".").concat(d)]||b[d]||m[d]||i;return n?a.a.createElement(u,s(s({ref:t},p),{},{components:n})):a.a.createElement(u,s({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);